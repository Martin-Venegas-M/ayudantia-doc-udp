---
title: "Manipulaci√≥n de datos en R"
date: "Mayo, 2025"
author: "" 
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: '16:9'
      countIncrementalSlides: false
      beforeInit: "https://jciturras.github.io/ayudantia-sol3051/slides/00-intro-r/macros.js"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
    css: ["https://jciturras.github.io/ayudantia-sol3051/slides/00-intro-r/xaringan-coes.css","https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"]
    seal: false # esto omite title slide autom√°tica  
---
layout: true
class: animated, fadeIn

---
class: inverse, left, middle

# _Manipulaci√≥n de datos en R_


Mart√≠n Venegas M√°rquez


***
[Doctorado en Psicolog√≠a UDP - Seminario Metodol√≥gico Disciplinario: Metodolog√≠as Cuantitativas - Oto√±o 2025]()

<br>

#### Mayo, 2025

---
class: inverse, left, middle

# Contenidos de la sesi√≥n

--

**0. Recordando...**

--

**1. Manejo b√°sico con R Base**

--

**2. Manejo b√°sico de Tidyverse**

--

**3. Manos a la obra**

```{r include=FALSE}
pacman::p_load(tidyverse)
```


---

class: middle, center, inverse

# _0. Recordando..._

---
# Tipos de datos üî¢üî°

| Tipo     | Ejemplo                | Descripci√≥n |
|----------|------------------------|-------------|
| numeric | `2`, `3.14`            | N√∫meros reales, con decimales |
| integer   | `4L`                   | N√∫meros enteros (terminan en `L`) |
| logical   | `TRUE`, `FALSE`        | Valores booleanos (s√≠ o no, verdadero o falso) |
| character    | `"hola"`              | Cadenas de caracteres |
| factor   | `factor(c("H", "M"))` | Variables categ√≥ricas, usadas com√∫nmente para factores o niveles |
| complex   | `2+3i`, `1-1i`           | N√∫meros complejos con partes reales e imaginarias |

---
# Estructuras de datos üß±

| Estructura   | Descripci√≥n                                                                 | Ejemplo                                  |
|--------------|------------------------------------------------------------------------------|------------------------------------------|
| **vector**   | Secuencia de elementos del mismo tipo                                       | `c(1, 2, 3)`                              |
| **data.frame** | Tabla bidimensional con columnas de distintos tipos                        | `data.frame(nombre = c("Ana", "Luis"), edad = c(25, 30))` |
| **list**     | Colecci√≥n de objetos de tipos distintos                                      | `list(nombre = "Ana", edad = 30, notas = c(6, 7, 5))` |
| **matrix**   | Arreglo bidimensional con elementos del mismo tipo                          | `matrix(1:6, nrow = 2)`                   |
| **array**    | Arreglo multidimensional (m√°s de 2 dimensiones), todos del mismo tipo        | `array(1:12, dim = c(2, 2, 3))`           |

---
# Estructuras de datos üß±

![](https://i0.wp.com/balachandark.com/wp-content/uploads/2022/08/dataStructuresNew.png)

---
# Operadores üî£

| Tipo de operador   | S√≠mbolos                         | Uso principal                                   | Ejemplo                                         |
| ------------------ | -------------------------------- | ----------------------------------------------- | ----------------------------------------------- | 
| **Aritm√©ticos**    | `+`, `-`, `*`, `/`, `^`          | Realizan operaciones matem√°ticas b√°sicas        | `3 + 2`, `juan * 2`                             |
| **Relacionales**   | `==`, `!=`, `>`, `<`, `>=`, `<=` | Comparan valores, retornando `TRUE` o `FALSE`   | `ana != 45`, `juan < matias`                    |
| **L√≥gicos**        | `&`, &#124;, `!`                     | Combinan condiciones booleanas (Y, O, Negaci√≥n) |  `ana > 30 & juan > 30`                         |
| **De pertenencia** | `%in%`                           | Verifica si un elemento pertenece a un conjunto | `33 %in% c(juan, matias‚Ä¶)`                      |

---
# Algunos √©nfasis necesarios...

--

- R es _case sensitive_. Es decir, distingue entre may√∫sculas y min√∫sculas.

--

No es lo mismo

--

```r
objeto <- 1
```

--

A

--

```r
Objeto <- 1
```

---
# Algunos √©nfasis necesarios...

--

- El nombrar objetos en R tiene ciertas reglas:

--

  * Los nombres pueden contener letra y n√∫meros, pero siempre deben empezar con una letra. Comenzar un objeto con n√∫meros o caracteres especiales no es v√°lido. Ej. `2objeto`
  
--

  * Los espacios y caracteres especiales deben evitarse. Utilizar "_" para separar palabras. Ej. `objeto_uno` en vez de `objeto uno`
  
--

  * Evitar utilizar nombres de funciones como nombres de objetos. Ej. `mean`
  
---
# Algunos √©nfasis necesarios...

--

- Si a un objeto se le pone el mismo nombre que otro que ya tengamos, este se sobrescribe y se pierde el anterior. (Siempre definir nombres distintos)

--

```{r}
x <- 4
x

x <- 2
x
```

--

`x` fue sobreescrito, pas√≥ de 4 a 2

---
class: middle, center, inverse

# _1. Manejo b√°sico con R Base_

---
# Estructuras fundamentales de acceso üß±

--

## Retomemos los datos de ejemplo...

--

```{r}
datos <- data.frame(
  persona = c("Juan", "Matias", "Ana", "Leonor", "Sebastian"),
  edad = c(24, 35, 45, 65, 12)
)
```

---
# Estructuras fundamentales de acceso üß±

--

## `$` (acceso por nombre)

--

- √ötil para acceder a una columna por nombre en un `data.frame` o `tibble`.

--

- Requiere que el nombre sea v√°lido (sin espacios, ni s√≠mbolos extra√±os).

--

```{r}
datos$edad
```

---
# Estructuras fundamentales de acceso üß±

--

## `[[]]` (acceso por nombre o posici√≥n)

--

- Similar al `$`, pero m√°s flexible (acepta nombres que no son v√°lidos como `datos$"edad promedio"`).

--

- Devuelve el vector completo de esa columna.

```{r}
datos[["edad"]]
datos[[2]]  # Segunda columna
```

---
# Estructuras fundamentales de acceso üß±

--

## `[,]` (acceso por fila y columna)

--

- Muy poderoso: se usa para seleccionar por posici√≥n filas y columnas.

--

- Sintaxis: datos[fila, columna]

--

---
# Estructuras fundamentales de acceso üß±
## `[,]` (acceso por fila y columna)

```{r}
datos[1, ]       # Primera fila
datos[, 2]       # Segunda columna
```

---
# Estructuras fundamentales de acceso üß±
## `[,]` (acceso por fila y columna)

```{r}
datos[1:3, 1:2]  # Subconjunto de filas y columnas
```

---

# Estructuras fundamentales de acceso üß±

--

## `names()` y `colnames()` / `rownames()`

--

- Para obtener o cambiar nombres de columnas o filas.

--

```{r}
names(datos)
colnames(datos)[2] <- "edad_en_anios" # Cambiar nombre a columna 2
datos[["edad_en_anios"]] # Extraer vector de columna renombrada
```

---
# Estructuras fundamentales de acceso üß±

--

## Sintesis

| Estructura | Devuelve      | Acceso por      | √ötil para                        |
| ---------- | ------------- | --------------- | -------------------------------- |
| `$`        | Vector        | Nombre v√°lido   | Acceso r√°pido a columnas         |
| `[[]]`     | Vector        | Nombre o √≠ndice | Nombres no est√°ndar o por √≠ndice |
| `[ , ]`    | Vector o `df` | Fila y columna  | Subconjuntos m√°s generales       |


---
# Estructuras adicionales √∫tiles de conocer, pero poco utilizadas en la pr√°ctica

--

## `attach()` / `detach()` ‚ö†Ô∏èNO RECOMENDADO

--

- Permiten acceder directamente a variables de un data.frame, pero pueden generar conflictos y no se recomienda su uso en trabajo reproducible.

---
# Funciones b√°sicas en R base üî¢üî®

--
## `sort()` ‚Äî Ordenar vectores

--

- Para ordenar, seleccionar y transformar columnas

--

```{r}
sort(c(3, 1, 4, 1, 5)) # Ordena vectores de menor a mayor.
```
--

- Argumento √∫til: `decreasing = TRUE` para ordenar de mayor a menor.

--

```{r}
sort(c(3, 1, 4, 1, 5), decreasing = TRUE)
```

---
# Funciones b√°sicas en R base üî¢üî®

--

## `order()` ‚Äî √çndices para ordenar

--

```{r}
x <- c(20, 10, 30)
order(x)
```

--

- Devuelve los √≠ndices que ordenar√≠an el vector.

--

- Muy √∫til para ordenar filas de un `data.frame`:

---
# Funciones b√°sicas en R base üî¢üî®
## `order()` ‚Äî √çndices para ordenar

--

```{r}
datos # Antes de ordenar
```

--

```{r}
datos[order(datos$edad_en_anios), ] # Despu√©s de ordenar
```
---
# Funciones b√°sicas en R base üî¢üî®

--

## `rank()` ‚Äî Rango dentro del vector

--

- Asigna rangos a cada valor.

--

```{r}
rank(c(100, 50, 200))
```

--

- En caso de empates, asigna promedios.

--

```{r}
rank(c(50, 100, 50, 200))
```

---
# Funciones b√°sicas en R base üî¢üî®

--

## `unique()` ‚Äî Valores √∫nicos

--

```{r}
unique(c(1, 2, 2, 3))
```

--

- Elimina duplicados.

--

- Muy √∫til para explorar categor√≠as de una variable.

---
# Funciones b√°sicas en R base üî¢üî®

--

## `table()` ‚Äî Frecuencia de valores

--

```{r}
table(c("hombre", "mujer", "mujer"))
```

--

- Devuelve una tabla de frecuencias absolutas.

--

- Se puede aplicar a columnas de un data.frame.

---
# Funciones b√°sicas en R base üî¢üî®

--

## `which()` ‚Äî Posiciones de valores l√≥gicos `TRUE`

--

```{r}
x <- c(10, 20, 30)
which(x > 15)
```

--

- Devuelve los √≠ndices donde se cumple una condici√≥n.

---
# Funciones b√°sicas en R base üî¢üî®

--

### Extra √∫til: `seq()` y `rep()`

--

```{r}
seq(1, 10, by = 2)  # Secuencia: 1 3 5 7 9
rep("hola", 3)      # Repetir: "hola" "hola" "hola"
```

--

- Construcci√≥n de vectores para tests o simulaciones.
---
# Funciones b√°sicas en R base üî¢üî®

--

| Funci√≥n    | ¬øQu√© hace?                    | ¬øD√≥nde se usa?                     |
| ---------- | ----------------------------- | ---------------------------------- |
| `sort()`   | Ordena valores                | Listados ordenados                 |
| `order()`  | Devuelve posiciones ordenadas | Ordenar filas de un `data.frame`   |
| `rank()`   | Asigna rango                  | Ranking de ingresos, edades, etc.  |
| `unique()` | Elimina duplicados            | Explorar categor√≠as                |
| `table()`  | Frecuencia                    | Distribuci√≥n de respuestas         |
| `which()`  | √çndices que cumplen condici√≥n | Subset, localizaci√≥n de casos      |
| `seq()`    | Secuencias num√©ricas          | Simulaciones, generaci√≥n de datos  |
| `rep()`    | Repetici√≥n                    | Construcci√≥n de vectores           |

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `if` y `else`: decisiones condicionales

--

```{r}
x <- 10

if (x > 5) {
  print("Mayor que 5")
} else {
  print("Menor o igual a 5")
}
```
--

- `if()` eval√∫a una condici√≥n l√≥gica.

--

- Si es verdadera, ejecuta el c√≥digo dentro del bloque `{}`.

--

- Si es falsa, se puede usar `else` para ejecutar otra instrucci√≥n.

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `ifelse()`: condicional vectorizado

--

```{r}
edades <- c(20, 35, 15)

ifelse(edades >= 18, "adulto", "menor")
```
--

- Aplica condiciones sobre vectores completos.

--

- √ötil para crear nuevas variables condicionales.
---
# Estructuras de programaci√≥n b√°sicas en R

--

## `for()`: bucles iterativos

--

```{r}
edades <- c(20, 35, 15) # Creamos vector de edades

for (i in edades) {
  print(i * 2)
}
```
--

- Ejecuta un bloque de c√≥digo repetidamente para cada valor.

--

- √ötil para operaciones simples o procesos acumulativos.

---
# Estructuras de programaci√≥n b√°sicas en R

## `for()`: bucles iterativos

--

¬øY si queremos guardar ese vector?

--

```{r}
edades <- c(20, 35, 15) # Creamos vector de edades
dobles <- numeric(length(edades))  # Creamos un vector vac√≠o del mismo largo

for (i in 1:length(edades)) {
  dobles[i] <- edades[i] * 2
}

dobles
```

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `while()`: repite mientras se cumpla una condici√≥n

--

```{r}
x <- 1

while (x < 5) {
  print(x)
  x <- x + 1
}
```

--

- Mientras la condici√≥n se mantenga verdadera, ejecuta el c√≥digo dentro de los `{}`

--

- Menos usado que `for()`, pero √∫til si no sabes cu√°ntas iteraciones necesitas.

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `next` y `break`: control de flujo en bucles

--

```{r}
for (i in 1:5) {
  if (i == 3) next   # salta la iteraci√≥n si i == 3
  print(i)
}

for (i in 1:5) {
  if (i == 3) break  # corta el bucle si i == 3
  print(i)
}

```


---
# Estructuras de programaci√≥n b√°sicas en R

--

## Funciones propias: generalizar c√≥digo

--

```{r}
# Crear funci√≥n
multiplicar_por_dos <- function(x) {
  return(x*2)
} 

edades <- c(20, 35, 15) # Crear vector de edades

multiplicar_por_dos(edades) # Aplicar funci√≥n

```

--

- Dentro de `function()` se plantean los parametros

--

- Dentro de `{}` se explicita el comportamiento de la funci√≥n

---
# Estructuras de programaci√≥n b√°sicas en R

--

## Funciones propias: a nuestro criterio

--

```{r}
multiplicar_por_dos <- function(x) {
  if(is.numeric(x)){
    return(x*2)
  } else {
    print("¬°ERROR! El vector debe ser n√∫merico")
  }

}

```

--

- A√±adamos una condici√≥n: para que la funci√≥n se aplique correctamente, el vector debe ser n√∫merico

--

- Si el vector es n√∫merico, entonces que aplique la funci√≥n

--

- Si el vector no es n√∫merico, que entregue un mensaje de error

---

# Estructuras de programaci√≥n b√°sicas en R

--

## Funciones propias: a nuestro criterio

--

```{r}
edades <- c(20, 35, 15) # Crear vector de edades
edades_character <- c("20", "35", "15") # Crear vector de edades en character
```

--

```{r}
multiplicar_por_dos(edades)
multiplicar_por_dos(edades_character)
```

---

# Estructuras de programaci√≥n b√°sicas en R

| Estructura   | Usos                                     |
| ------------ | ------------------------------------------------- |
| `if / else`  | Aplicar l√≥gica binaria (mayores de edad, etc.) |
| `ifelse()`   | Recodificaci√≥n vectorial (sexo, regiones, etc.)   |
| `for`        | Automatizar tareas repetitivas                    |
| `while`      | Evaluar condiciones din√°micas                     |
| `next`       | Saltar casos espec√≠ficos (ej. valores perdidos)   |
| `break`      | Cortar ejecuci√≥n si hay un error                  |
| `function()` | Encapsulaci√≥n y reutilizaci√≥n del c√≥digo  |

---
class: middle, center, inverse

# _2. Manejo b√°sico con tidyverse_
---
# Usando dplyr üîß

##  Operador *pipe* `%>%`

.left-column[

- La herramienta n√∫mero uno de `dplyr` (y `tidyverse` en general)

- El *pipe* (`%>%`) es un **operador** que nos permite **encadenar funciones** de manera m√°s legible y ordenada.

- Se puede leer como: **"y luego"**. Es decir, el resultado de una operaci√≥n se pasa como primer argumento a la siguiente.
]

.center[.right-column[

![](input/images/pipe-logo.png)

]]

---
# Usando dplyr üîß
##  Operador *pipe* `%>%`

--

 üìå Ejemplo sin *pipe*:

```r
filter(arrange(select(df, var1, var2), var1), var2 > 5)
```

--

üìå Ejemplo con pipe:

```r
df %>%
  select(var1, var2) %>%
  arrange(var1) %>%
  filter(var2 > 5)
```

---
# Usando dplyr üîß
##  Operador *pipe* `%>%`

--

‚úÖ Ventajas:

--

- M√°s legibilidad y l√≥gica paso a paso

--

- Facilita el _debugging_ (probar parte por parte)

--

- Fomenta un c√≥digo m√°s declarativo (lo que quiero hacer, no c√≥mo)
---
.center[![](input/images/pipes.png)]
---
# Usando dplyr üîß

--

## Retomemos los datos de ejemplo... y adaptemoslos

--

```{r}
datos <- data.frame(
  persona = c("Juan", "Matias", "Ana", "Leonor", "Sebastian"),
  edad = c(24, 35, 45, 65, 12),
  sexo = c("Hombre", "Hombre", "Mujer", "Mujer", "Hombre"),
  ingresos = c(1000000, 800000, 1300000, 1500000, 0)
)
```

---
# Usando dplyr üîß

--

## `select()`

.left-column[

- Permite seleccionar columnas espec√≠ficas de un dataframe.

- √ötil para reducir la base a solo las variables necesarias.

```{r}
datos %>% select(edad, sexo)
```
]


.right-column[
![](input/images/select.png)
]
---
# Usando dplyr üîß

## `select()`

--

- Existen muchas formas de seleccionar las columnas de un dataframe

--

- Puede ser por nombre de variables, rangos, patrones en el nombre de las variables, etc.

--

- Por ejemplo...

--

```{r}
datos %>% select(edad:ingresos) # Selecci√≥n por rangos
```

---
# Usando dplyr üîß

## `select()`

- Existen muchas formas de seleccionar las columnas de un dataframe

- Puede ser por nombre de variables, rangos, exclusiones, etc.

- Por ejemplo...

```{r}
datos %>% select(-sexo) # Selecci√≥n por exclusi√≥n de sexo
```

---
# Usando dplyr üîß

| M√©todo                    | Ejemplo                                 | Descripci√≥n                                                                          |
| ------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------ |
| Selecci√≥n directa         | `select(var1, var2)`                | Selecciona columnas por nombre expl√≠cito.                                            |
| Rango de variables        | `select(var1:var5)`                 | Selecciona todas las columnas desde `var1` hasta `var5`.                             |
| `starts_with()`           | `select(starts_with("ing"))`        | Selecciona columnas cuyos nombres comienzan con cierto texto.                        |
| `ends_with()`             | `select(ends_with("_cat"))`         | Selecciona columnas cuyos nombres terminan con cierto texto.                         |
| `contains()`              | `select(contains("edad"))`          | Selecciona columnas cuyos nombres contienen cierto texto.                            |

---
# Usando dplyr üîß


| M√©todo                    | Ejemplo                                 | Descripci√≥n                                                                          |
| ------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------ |
| `matches()`               | `select(matches("^var[0-9]+$"))`    | Selecciona columnas que cumplan con una expresi√≥n regular.                           |
| `all_of()`                | `select(all_of(c("var1", "var2")))` | Selecciona un conjunto de columnas que est√°n en un vector. Da error si falta alguna. |
| `any_of()`                | `select(any_of(c("var1", "varX")))` | Igual que `all_of()`, pero **ignora** las que no existen.                            |
| Exclusi√≥n (`-`)           | `select(-var1)`                     | Excluye una columna espec√≠fica.                                                      |
| Combinaci√≥n de selectores | `select(starts_with("p"), -p10)`    | Combinaci√≥n flexible de condiciones.                                                 |

---
# Usando dplyr üîß

--

## `rename()`

--

- Renombra columnas de forma directa.

--

- Ideal para mejorar la legibilidad de nombres t√©cnicos.

--

```{r}
datos %>% rename(edad_respondente = edad)
```

---
# Usando dplyr üîß

--

## `filter()`

--

- Filtra filas seg√∫n condiciones l√≥gicas.

--

- Para crear subconjuntos de la base.

--

- ¬°Aqu√≠ ser√°n especialmente √∫tiles los operadores relacionales y l√≥gicos!

```{r}
datos %>% filter(sexo == "Mujer" & edad > 30)
```
---
# Usando dplyr üîß

--

## `mutate()`

--

- Crea nuevas columnas o transforma columnas existentes.

--

- Ideal para generar nuevas variables derivadas.

--

```{r}
datos %>% mutate(edad2 = edad^2)
```

---
# Usando dplyr üîß

--

## `case_when()`

--

- Permite recodificar valores en base a condiciones.

--

- M√°s legible y potente que `ifelse()` para m√∫ltiples condiciones.

--

```{r}
datos %>% mutate(rango_edad = case_when(
  edad < 18 ~ "menor de edad",
  edad >= 18 & edad < 60 ~ "adulto",
  edad >= 60 ~ "adulto mayor"
))

```

---
# Usando dplyr üîß

--

## `group_by()` + `summarise()`

--

- `group_by()` permite hacer operaciones en base a las categor√≠as de una variable categ√≥rica

--

- Su principal utilidad recae en hacer resumenes estad√≠sticos por grupo a trav√©s de `summarise()`

```{r}
datos %>% group_by(sexo) %>% summarise(media_ingresos = mean(ingresos))
```

---
## `group_by()`
![](input/images/group_by.png)
---
## `group_by()` + `summarise()`
.![:scale 50%](input/images/summarise.png)

---
# Usando dplyr üîß

--

## `distinct()`

--

- Entrega solo las filas √∫nicas (sin duplicados).

--

- Muy √∫til para explorar niveles de una variable categ√≥rica.

--

```{r}
datos %>% distinct(sexo)
```

---
# Usando dplyr üîß

--

## `relocate()`

--

- Cambia el orden de las columnas.

--

- Mejora la organizaci√≥n del dataset.

--

```{r}
datos %>% relocate(edad, .after = sexo)
```
---

# Usando dplyr üîß

--

## `arrange()`

--

- Ordena las filas por una o m√°s variables.

--

- Puedes ordenar ascendente o descendente.

--

```{r}
datos %>% arrange(edad) # Ascendente (por defecto)
```

---
# Usando dplyr üîß

--

## `arrange()`

--

- Ordena las filas por una o m√°s variables.

--

- Puedes ordenar ascendente o descendente.

--

```{r}
datos %>% arrange(desc(ingresos)) # Descendente
```

---
## Un resumen visual üëÄ

.center[![](input/images/dplyr.png)]
---