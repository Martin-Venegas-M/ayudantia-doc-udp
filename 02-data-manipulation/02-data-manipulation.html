<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Manipulaci√≥n de datos en R</title>
    <meta charset="utf-8" />
    <meta name="author" content="" />
    <script src="libs/header-attrs-2.26/header-attrs.js"></script>
    <link rel="stylesheet" href="https://jciturras.github.io/ayudantia-sol3051/slides/00-intro-r/xaringan-coes.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

layout: true
class: animated, fadeIn

---
class: inverse, left, middle

# _Manipulaci√≥n de datos en R üî¢üî®üîß_


Mart√≠n Venegas M√°rquez


***
[Doctorado en Psicolog√≠a UDP - Seminario Metodol√≥gico Disciplinario: Metodolog√≠as Cuantitativas - Oto√±o 2025]()

&lt;br&gt;

#### Mayo, 2025

---
![](input/images/Diapositiva1.PNG)
---
![](input/images/Diapositiva2.PNG)
---
class: inverse, left, middle

# Contenidos de la sesi√≥n

--

**0. Recordando...**

--

**1. Manejo b√°sico con R Base**

--

**2. Manejo b√°sico de Tidyverse**

--

**3. Manos a la obra**




---

class: middle, center, inverse

# _0. Recordando..._

---
# Tipos de datos üî¢üî°

| Tipo     | Ejemplo                | Descripci√≥n |
|----------|------------------------|-------------|
| numeric | `2`, `3.14`            | N√∫meros reales, con decimales |
| integer   | `4L`                   | N√∫meros enteros (terminan en `L`) |
| logical   | `TRUE`, `FALSE`        | Valores booleanos (s√≠ o no, verdadero o falso) |
| character    | `"hola"`              | Cadenas de caracteres |
| factor   | `factor(c("H", "M"))` | Variables categ√≥ricas, usadas com√∫nmente para factores o niveles |
| complex   | `2+3i`, `1-1i`           | N√∫meros complejos con partes reales e imaginarias |

---
# Estructuras de datos üß±

| Estructura   | Descripci√≥n                                                                 | Ejemplo                                  |
|--------------|------------------------------------------------------------------------------|------------------------------------------|
| **vector**   | Secuencia de elementos del mismo tipo                                       | `c(1, 2, 3)`                              |
| **data.frame** | Tabla bidimensional con columnas de distintos tipos                        | `data.frame(nombre = c("Ana", "Luis"), edad = c(25, 30))` |
| **list**     | Colecci√≥n de objetos de tipos distintos                                      | `list(nombre = "Ana", edad = 30, notas = c(6, 7, 5))` |
| **matrix**   | Arreglo bidimensional con elementos del mismo tipo                          | `matrix(1:6, nrow = 2)`                   |
| **array**    | Arreglo multidimensional (m√°s de 2 dimensiones), todos del mismo tipo        | `array(1:12, dim = c(2, 2, 3))`           |

---
# Estructuras de datos üß±

![](https://i0.wp.com/balachandark.com/wp-content/uploads/2022/08/dataStructuresNew.png)

---
# Operadores üî£

| Tipo de operador   | S√≠mbolos                         | Uso principal                                   | Ejemplo                                         |
| ------------------ | -------------------------------- | ----------------------------------------------- | ----------------------------------------------- | 
| **Aritm√©ticos**    | `+`, `-`, `*`, `/`, `^`          | Realizan operaciones matem√°ticas b√°sicas        | `3 + 2`, `juan * 2`                             |
| **Relacionales**   | `==`, `!=`, `&gt;`, `&lt;`, `&gt;=`, `&lt;=` | Comparan valores, retornando `TRUE` o `FALSE`   | `ana != 45`, `juan &lt; matias`                    |
| **L√≥gicos**        | `&amp;`, &amp;#124;, `!`                     | Combinan condiciones booleanas (Y, O, Negaci√≥n) |  `ana &gt; 30 &amp; juan &gt; 30`                         |
| **De pertenencia** | `%in%`                           | Verifica si un elemento pertenece a un conjunto | `33 %in% c(juan, matias‚Ä¶)`                      |

---
# Algunos √©nfasis necesarios...

--

### R es _case sensitive_. Es decir, distingue entre may√∫sculas y min√∫sculas.

--

No es lo mismo

--

```r
objeto &lt;- 1
```

--

A

--

```r
Objeto &lt;- 1
```

---
# Algunos √©nfasis necesarios...

--

### El nombrar objetos en R tiene ciertas reglas:

--

- Los nombres pueden contener letra y n√∫meros, pero siempre deben empezar con una letra. Comenzar un objeto con n√∫meros o caracteres especiales no es v√°lido. Ej. `2objeto`
  
--

- Los espacios y caracteres especiales deben evitarse. Utilizar "_" para separar palabras. Ej. `objeto_uno` en vez de `objeto uno`
  
--

- Evitar utilizar nombres de funciones como nombres de objetos. Ej. `mean`
  
---
# Algunos √©nfasis necesarios...

--

### Si a un objeto se le pone el mismo nombre que otro que ya tengamos, este se sobrescribe y se pierde el anterior. (Siempre definir nombres distintos)

--


```r
x &lt;- 4
x
```

```
## [1] 4
```

```r
x &lt;- 2
x
```

```
## [1] 2
```

--

- `x` fue sobreescrito, pas√≥ de 4 a 2

---
class: middle, center, inverse

# _1. Manejo b√°sico con R Base_

---
# Estructuras fundamentales de acceso üß±

--

## Retomemos los datos de ejemplo...

--


```r
datos &lt;- data.frame(
  persona = c("Juan", "Matias", "Ana", "Leonor", "Sebastian"),
  edad = c(24, 35, 45, 65, 12)
)
```

---
# Estructuras fundamentales de acceso üß±

--

## `$` (acceso por nombre)

--

- √ötil para acceder a una columna por nombre en un `data.frame` o `tibble`.

--

- Requiere que el nombre sea v√°lido (sin espacios, ni s√≠mbolos extra√±os).

--


```r
datos$edad
```

```
## [1] 24 35 45 65 12
```

---
# Estructuras fundamentales de acceso üß±

--

## `[[]]` (acceso por nombre o posici√≥n)

--

- Similar al `$`, pero m√°s flexible (acepta nombres que no son v√°lidos como `datos$"edad promedio"`).

--

- Devuelve el vector completo de esa columna.


```r
datos[["edad"]]
```

```
## [1] 24 35 45 65 12
```

```r
datos[[2]]  # Segunda columna
```

```
## [1] 24 35 45 65 12
```

---
# Estructuras fundamentales de acceso üß±

--

## `[,]` (acceso por fila y columna)

--

- Muy poderoso: se usa para seleccionar por posici√≥n filas y columnas.

--

- Sintaxis: datos[fila, columna]

--

---
# Estructuras fundamentales de acceso üß±
## `[,]` (acceso por fila y columna)


```r
datos[1, ]       # Primera fila
```

```
##   persona edad
## 1    Juan   24
```

```r
datos[, 2]       # Segunda columna
```

```
## [1] 24 35 45 65 12
```

---
# Estructuras fundamentales de acceso üß±
## `[,]` (acceso por fila y columna)


```r
datos[1:3, 1:2]  # Subconjunto de filas y columnas
```

```
##   persona edad
## 1    Juan   24
## 2  Matias   35
## 3     Ana   45
```

---

# Estructuras fundamentales de acceso üß±

--

## `names()` y `colnames()` / `rownames()`

--

- Para obtener o cambiar nombres de columnas o filas.

--


```r
names(datos)
```

```
## [1] "persona" "edad"
```

```r
colnames(datos)[2] &lt;- "edad_en_anios" # Cambiar nombre a columna 2
datos[["edad_en_anios"]] # Extraer vector de columna renombrada
```

```
## [1] 24 35 45 65 12
```

---
# Estructuras fundamentales de acceso üß±

--

## Sintesis

| Estructura | Devuelve      | Acceso por      | √ötil para                        |
| ---------- | ------------- | --------------- | -------------------------------- |
| `$`        | Vector        | Nombre v√°lido   | Acceso r√°pido a columnas         |
| `[[]]`     | Vector        | Nombre o √≠ndice | Nombres no est√°ndar o por √≠ndice |
| `[ , ]`    | Vector o `df` | Fila y columna  | Subconjuntos m√°s generales       |


---
# Estructuras adicionales √∫tiles de conocer, pero poco utilizadas en la pr√°ctica

--

## `attach()` / `detach()` ‚ö†Ô∏èNO RECOMENDADO

--

- Permiten acceder directamente a variables de un data.frame, pero pueden generar conflictos y no se recomienda su uso en trabajo reproducible.

---
# Funciones b√°sicas en R base üî¢üî®

--
## `sort()` ‚Äî Ordenar vectores

--

- Para ordenar, seleccionar y transformar columnas

--


```r
sort(c(3, 1, 4, 1, 5)) # Ordena vectores de menor a mayor.
```

```
## [1] 1 1 3 4 5
```
--

- Argumento √∫til: `decreasing = TRUE` para ordenar de mayor a menor.

--


```r
sort(c(3, 1, 4, 1, 5), decreasing = TRUE)
```

```
## [1] 5 4 3 1 1
```

---
# Funciones b√°sicas en R base üî¢üî®

--

## `order()` ‚Äî √çndices para ordenar

--


```r
x &lt;- c(20, 10, 30)
order(x)
```

```
## [1] 2 1 3
```

--

- Devuelve los √≠ndices que ordenar√≠an el vector.

--

- Muy √∫til para ordenar filas de un `data.frame`:

---
# Funciones b√°sicas en R base üî¢üî®
## `order()` ‚Äî √çndices para ordenar

--


```r
datos # Antes de ordenar
```

```
##     persona edad_en_anios
## 1      Juan            24
## 2    Matias            35
## 3       Ana            45
## 4    Leonor            65
## 5 Sebastian            12
```

--


```r
datos[order(datos$edad_en_anios), ] # Despu√©s de ordenar
```

```
##     persona edad_en_anios
## 5 Sebastian            12
## 1      Juan            24
## 2    Matias            35
## 3       Ana            45
## 4    Leonor            65
```
---
# Funciones b√°sicas en R base üî¢üî®

--

## `rank()` ‚Äî Rango dentro del vector

--

- Asigna rangos a cada valor.

--


```r
rank(c(100, 50, 200))
```

```
## [1] 2 1 3
```

--

- En caso de empates, asigna promedios.

--


```r
rank(c(50, 100, 50, 200))
```

```
## [1] 1.5 3.0 1.5 4.0
```

---
# Funciones b√°sicas en R base üî¢üî®

--

## `unique()` ‚Äî Valores √∫nicos

--


```r
unique(c(1, 2, 2, 3))
```

```
## [1] 1 2 3
```

--

- Elimina duplicados.

--

- Muy √∫til para explorar categor√≠as de una variable.

---
# Funciones b√°sicas en R base üî¢üî®

--

## `which()` ‚Äî Posiciones de valores l√≥gicos `TRUE`

--


```r
x &lt;- c(10, 20, 30)
which(x &gt; 15)
```

```
## [1] 2 3
```

--

- Devuelve los √≠ndices donde se cumple una condici√≥n.

---
# Funciones b√°sicas en R base üî¢üî®

--

### Extra √∫til: `seq()` y `rep()`

--


```r
seq(1, 10, by = 2)  # Secuencia: 1 3 5 7 9
```

```
## [1] 1 3 5 7 9
```

```r
rep("hola", 3)      # Repetir: "hola" "hola" "hola"
```

```
## [1] "hola" "hola" "hola"
```

--

- Construcci√≥n de vectores para tests o simulaciones.
---
# Funciones b√°sicas en R base üî¢üî®

--

| Funci√≥n    | ¬øQu√© hace?                    | ¬øD√≥nde se usa?                     |
| ---------- | ----------------------------- | ---------------------------------- |
| `sort()`   | Ordena valores                | Listados ordenados                 |
| `order()`  | Devuelve posiciones ordenadas | Ordenar filas de un `data.frame`   |
| `rank()`   | Asigna rango                  | Ranking de ingresos, edades, etc.  |
| `unique()` | Elimina duplicados            | Explorar categor√≠as                |
| `which()`  | √çndices que cumplen condici√≥n | Subset, localizaci√≥n de casos      |
| `seq()`    | Secuencias num√©ricas          | Simulaciones, generaci√≥n de datos  |
| `rep()`    | Repetici√≥n                    | Construcci√≥n de vectores           |

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `if` y `else`: decisiones condicionales

--


```r
x &lt;- 10

if (x &gt; 5) {
  print("Mayor que 5")
} else {
  print("Menor o igual a 5")
}
```

```
## [1] "Mayor que 5"
```
--

- `if()` eval√∫a una condici√≥n l√≥gica.

--

- Si es verdadera, ejecuta el c√≥digo dentro del bloque `{}`.

--

- Si es falsa, se puede usar `else` para ejecutar otra instrucci√≥n.

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `ifelse()`: condicional vectorizado

--


```r
edades &lt;- c(20, 35, 15)

ifelse(edades &gt;= 18, "adulto", "menor")
```

```
## [1] "adulto" "adulto" "menor"
```
--

- Aplica condiciones sobre vectores completos.

--

- √ötil para crear nuevas variables condicionales.
---
# Estructuras de programaci√≥n b√°sicas en R

--

## `for()`: bucles iterativos

--


```r
edades &lt;- c(20, 35, 15) # Creamos vector de edades

for (i in edades) {
  print(i * 2)
}
```

```
## [1] 40
## [1] 70
## [1] 30
```
--

- Ejecuta un bloque de c√≥digo repetidamente para cada valor.

--

- √ötil para operaciones simples o procesos acumulativos.

---
# Estructuras de programaci√≥n b√°sicas en R

## `for()`: bucles iterativos

--

¬øY si queremos guardar ese vector?

--


```r
edades &lt;- c(20, 35, 15) # Creamos vector de edades
dobles &lt;- numeric(length(edades))  # Creamos un vector vac√≠o del mismo largo

for (i in 1:length(edades)) {
  dobles[i] &lt;- edades[i] * 2
}

dobles
```

```
## [1] 40 70 30
```

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `while()`: repite mientras se cumpla una condici√≥n

--


```r
x &lt;- 1

while (x &lt; 5) {
  print(x)
  x &lt;- x + 1
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
```

--

- Mientras la condici√≥n se mantenga verdadera, ejecuta el c√≥digo dentro de los `{}`

--

- Menos usado que `for()`, pero √∫til si no sabes cu√°ntas iteraciones necesitas.

---
# Estructuras de programaci√≥n b√°sicas en R

--

## `next` y `break`: control de flujo en bucles

--


```r
for (i in 1:5) {
  if (i == 3) next   # salta la iteraci√≥n si i == 3
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 4
## [1] 5
```

```r
for (i in 1:5) {
  if (i == 3) break  # corta el bucle si i == 3
  print(i)
}
```

```
## [1] 1
## [1] 2
```


---
# Estructuras de programaci√≥n b√°sicas en R

--

## Funciones propias: generalizar c√≥digo

--


```r
# Crear funci√≥n
multiplicar_por_dos &lt;- function(x) {
  return(x*2)
} 

edades &lt;- c(20, 35, 15) # Crear vector de edades

multiplicar_por_dos(edades) # Aplicar funci√≥n
```

```
## [1] 40 70 30
```

--

- Dentro de `function()` se plantean los parametros

--

- Dentro de `{}` se explicita el comportamiento de la funci√≥n

---
# Estructuras de programaci√≥n b√°sicas en R

--

## Funciones propias: a nuestro criterio

--


```r
multiplicar_por_dos &lt;- function(x) {
  if(is.numeric(x)){
    return(x*2)
  } else {
    print("¬°ERROR! El vector debe ser n√∫merico")
  }

}
```

--

- A√±adamos una condici√≥n: para que la funci√≥n se aplique correctamente, el vector debe ser n√∫merico

--

- Si el vector es n√∫merico, entonces que aplique la funci√≥n

--

- Si el vector no es n√∫merico, que entregue un mensaje de error

---

# Estructuras de programaci√≥n b√°sicas en R

--

## Funciones propias: a nuestro criterio

--


```r
edades &lt;- c(20, 35, 15) # Crear vector de edades
edades_character &lt;- c("20", "35", "15") # Crear vector de edades en character
```

--


```r
multiplicar_por_dos(edades)
```

```
## [1] 40 70 30
```

```r
multiplicar_por_dos(edades_character)
```

```
## [1] "¬°ERROR! El vector debe ser n√∫merico"
```

---

# Estructuras de programaci√≥n b√°sicas en R

| Estructura   | Usos                                     |
| ------------ | ------------------------------------------------- |
| `if / else`  | Aplicar l√≥gica binaria (mayores de edad, etc.) |
| `ifelse()`   | Recodificaci√≥n vectorial (sexo, regiones, etc.)   |
| `for`        | Automatizar tareas repetitivas                    |
| `while`      | Evaluar condiciones din√°micas                     |
| `next`       | Saltar casos espec√≠ficos (ej. valores perdidos)   |
| `break`      | Cortar ejecuci√≥n si hay un error                  |
| `function()` | Encapsulaci√≥n y reutilizaci√≥n del c√≥digo  |

---
class: middle, center, inverse

# _2. Manejo b√°sico con tidyverse_
---
# Usando dplyr üîß

##  Operador *pipe* `%&gt;%`

.left-column[

- La herramienta n√∫mero uno de `dplyr` (y `tidyverse` en general)

- El *pipe* (`%&gt;%`) es un **operador** que nos permite **encadenar funciones** de manera m√°s legible y ordenada.

- Se puede leer como: **"y luego"**. Es decir, el resultado de una operaci√≥n se pasa como primer argumento a la siguiente.
]

.center[.right-column[

![](input/images/pipe-logo.png)

]]

---
.center[![](input/images/pipes.png)]
---
# Usando dplyr üîß
##  Operador *pipe* `%&gt;%`

--

 üìå Ejemplo sin *pipe*:

```r
filter(arrange(select(df, var1, var2), var1), var2 &gt; 5)
```

--

üìå Ejemplo con pipe:

```r
df %&gt;%
  select(var1, var2) %&gt;%
  arrange(var1) %&gt;%
  filter(var2 &gt; 5)
```

---
# Usando dplyr üîß
##  Operador *pipe* `%&gt;%`

--

‚úÖ Ventajas:

--

- M√°s legibilidad y l√≥gica paso a paso

--

- Facilita el _debugging_ (probar parte por parte)

--

- Fomenta un c√≥digo m√°s declarativo (lo que quiero hacer, no c√≥mo)
---
# Usando dplyr üîß

--

## Retomemos los datos de ejemplo... y adaptemoslos

--


```r
datos &lt;- data.frame(
  persona = c("Juan", "Matias", "Ana", "Leonor", "Sebastian"),
  edad = c(24, 35, 45, 65, 12),
  sexo = c("Hombre", "Hombre", "Mujer", "Mujer", "Hombre"),
  ingresos = c(1000000, 800000, 1300000, 1500000, 0),
  region = c("Metropolitana", "Metropolitana", "Valparaiso", "Valparaiso", "Antofagasta")
)
```

---
# Usando dplyr üîß

--

## `select()`

.left-column[

- Permite seleccionar columnas espec√≠ficas de un dataframe.

- √ötil para reducir la base a solo las variables necesarias.


```r
datos %&gt;% select(edad, sexo)
```

```
##   edad   sexo
## 1   24 Hombre
## 2   35 Hombre
## 3   45  Mujer
## 4   65  Mujer
## 5   12 Hombre
```
]


.right-column[
![](input/images/select.png)
]
---
# Usando dplyr üîß

## `select()`

--

- Existen muchas formas de seleccionar las columnas de un dataframe

--

- Puede ser por nombre de variables, rangos, exclusiones, etc.

--

- Por ejemplo...

--


```r
datos %&gt;% select(edad:ingresos) # Selecci√≥n por rangos
```

```
##   edad   sexo ingresos
## 1   24 Hombre  1000000
## 2   35 Hombre   800000
## 3   45  Mujer  1300000
## 4   65  Mujer  1500000
## 5   12 Hombre        0
```

---
# Usando dplyr üîß

## `select()`

- Existen muchas formas de seleccionar las columnas de un dataframe

- Puede ser por nombre de variables, rangos, exclusiones, etc.

- Por ejemplo...


```r
datos %&gt;% select(-sexo) # Selecci√≥n por exclusi√≥n de sexo
```

```
##     persona edad ingresos        region
## 1      Juan   24  1000000 Metropolitana
## 2    Matias   35   800000 Metropolitana
## 3       Ana   45  1300000    Valparaiso
## 4    Leonor   65  1500000    Valparaiso
## 5 Sebastian   12        0   Antofagasta
```

---
# Usando dplyr üîß

| M√©todo                    | Ejemplo                                 | Descripci√≥n                                                                          |
| ------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------ |
| Selecci√≥n directa         | `select(var1, var2)`                | Selecciona columnas por nombre expl√≠cito.                                            |
| Rango de variables        | `select(var1:var5)`                 | Selecciona todas las columnas desde `var1` hasta `var5`.                             |
| `starts_with()`           | `select(starts_with("ing"))`        | Selecciona columnas cuyos nombres comienzan con cierto texto.                        |
| `ends_with()`             | `select(ends_with("_cat"))`         | Selecciona columnas cuyos nombres terminan con cierto texto.                         |
| `contains()`              | `select(contains("edad"))`          | Selecciona columnas cuyos nombres contienen cierto texto.                            |

---
# Usando dplyr üîß


| M√©todo                    | Ejemplo                                 | Descripci√≥n                                                                          |
| ------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------ |
| `matches()`               | `select(matches("^var[0-9]+$"))`    | Selecciona columnas que cumplan con una expresi√≥n regular.                           |
| `all_of()`                | `select(all_of(c("var1", "var2")))` | Selecciona un conjunto de columnas que est√°n en un vector. Da error si falta alguna. |
| `any_of()`                | `select(any_of(c("var1", "varX")))` | Igual que `all_of()`, pero **ignora** las que no existen.                            |
| Exclusi√≥n (`-`)           | `select(-var1)`                     | Excluye una columna espec√≠fica.                                                      |
| Combinaci√≥n de selectores | `select(starts_with("p"), -p10)`    | Combinaci√≥n flexible de condiciones.                                                 |

---
# Usando dplyr üîß

--

## `rename()`

--

- Renombra columnas de forma directa.

--

- Ideal para mejorar la legibilidad de nombres t√©cnicos.

--


```r
datos %&gt;% rename(edad_respondente = edad)
```

```
##     persona edad_respondente   sexo ingresos        region
## 1      Juan               24 Hombre  1000000 Metropolitana
## 2    Matias               35 Hombre   800000 Metropolitana
## 3       Ana               45  Mujer  1300000    Valparaiso
## 4    Leonor               65  Mujer  1500000    Valparaiso
## 5 Sebastian               12 Hombre        0   Antofagasta
```

---
# Usando dplyr üîß

--

## `filter()`

--

- Filtra filas seg√∫n condiciones l√≥gicas.

--

- Para crear subconjuntos de la base.

--

- ¬°Aqu√≠ ser√°n especialmente √∫tiles los operadores relacionales y l√≥gicos!


```r
datos %&gt;% filter(sexo == "Mujer" &amp; edad &gt; 30)
```

```
##   persona edad  sexo ingresos     region
## 1     Ana   45 Mujer  1300000 Valparaiso
## 2  Leonor   65 Mujer  1500000 Valparaiso
```
---
# Usando dplyr üîß

--

## `mutate()`

--

- Crea nuevas columnas o transforma columnas existentes.

--

- Ideal para generar nuevas variables derivadas.

--


```r
datos %&gt;% mutate(edad2 = edad^2)
```

```
##     persona edad   sexo ingresos        region edad2
## 1      Juan   24 Hombre  1000000 Metropolitana   576
## 2    Matias   35 Hombre   800000 Metropolitana  1225
## 3       Ana   45  Mujer  1300000    Valparaiso  2025
## 4    Leonor   65  Mujer  1500000    Valparaiso  4225
## 5 Sebastian   12 Hombre        0   Antofagasta   144
```

---
# Usando dplyr üîß

--

## `case_when()`

--

- Permite recodificar valores en base a condiciones.

--

- M√°s legible y potente que `ifelse()` para m√∫ltiples condiciones.

--


```r
datos %&gt;% mutate(rango_edad = case_when(
  edad &lt; 18 ~ "menor de edad",
  edad &gt;= 18 &amp; edad &lt; 60 ~ "adulto",
  edad &gt;= 60 ~ "adulto mayor"
))
```

```
##     persona edad   sexo ingresos        region    rango_edad
## 1      Juan   24 Hombre  1000000 Metropolitana        adulto
## 2    Matias   35 Hombre   800000 Metropolitana        adulto
## 3       Ana   45  Mujer  1300000    Valparaiso        adulto
## 4    Leonor   65  Mujer  1500000    Valparaiso  adulto mayor
## 5 Sebastian   12 Hombre        0   Antofagasta menor de edad
```

---
# Usando dplyr üîß

--

## `group_by()` + `summarise()`

--

- `group_by()` permite hacer operaciones en base a las categor√≠as de una variable categ√≥rica

--

- Su principal utilidad recae en hacer resumenes estad√≠sticos por grupo a trav√©s de `summarise()`


```r
datos %&gt;% group_by(sexo) %&gt;% summarise(media_ingresos = mean(ingresos))
```

```
## # A tibble: 2 √ó 2
##   sexo   media_ingresos
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 Hombre         600000
## 2 Mujer         1400000
```

---
## `group_by()`
![](input/images/group_by.png)
---
## `group_by()` + `summarise()`
.![:scale 50%](input/images/summarise.png)

---
# Usando dplyr üîß

--

## `distinct()`

--

- Entrega solo las filas √∫nicas (sin duplicados).

--

- Muy √∫til para explorar niveles de una variable categ√≥rica.

--


```r
datos %&gt;% distinct(sexo)
```

```
##     sexo
## 1 Hombre
## 2  Mujer
```

---
# Usando dplyr üîß

--

## `relocate()`

--

- Cambia el orden de las columnas.

--

- Mejora la organizaci√≥n del dataset.

--


```r
datos %&gt;% relocate(edad, .after = sexo)
```

```
##     persona   sexo edad ingresos        region
## 1      Juan Hombre   24  1000000 Metropolitana
## 2    Matias Hombre   35   800000 Metropolitana
## 3       Ana  Mujer   45  1300000    Valparaiso
## 4    Leonor  Mujer   65  1500000    Valparaiso
## 5 Sebastian Hombre   12        0   Antofagasta
```
---

# Usando dplyr üîß

--

## `arrange()`

--

- Ordena las filas por una o m√°s variables.

--

- Puedes ordenar ascendente o descendente.

--


```r
datos %&gt;% arrange(edad) # Ascendente (por defecto)
```

```
##     persona edad   sexo ingresos        region
## 1 Sebastian   12 Hombre        0   Antofagasta
## 2      Juan   24 Hombre  1000000 Metropolitana
## 3    Matias   35 Hombre   800000 Metropolitana
## 4       Ana   45  Mujer  1300000    Valparaiso
## 5    Leonor   65  Mujer  1500000    Valparaiso
```

---
# Usando dplyr üîß

--

## `arrange()`

--

- Ordena las filas por una o m√°s variables.

--

- Es posible ordenar de manera ascendente o descendente.

--


```r
datos %&gt;% arrange(desc(ingresos)) # Descendente
```

```
##     persona edad   sexo ingresos        region
## 1    Leonor   65  Mujer  1500000    Valparaiso
## 2       Ana   45  Mujer  1300000    Valparaiso
## 3      Juan   24 Hombre  1000000 Metropolitana
## 4    Matias   35 Hombre   800000 Metropolitana
## 5 Sebastian   12 Hombre        0   Antofagasta
```

---
## Un resumen visual üëÄ

.center[![](input/images/dplyr.png)]
---
# Usando dplyr üîß

--

## Joins üóùÔ∏è

- Las bases de datos complejas suelen estar divididas en varias tablas.

--

- Por ejemplo: una tabla de personas y otra de hogares.

--

- Los **joins** nos permiten cruzar estas tablas seg√∫n una clave com√∫n.

--

- Evitamos duplicaci√≥n y facilitamos el an√°lisis modular de datos.

---

# Usando dplyr üîß

## Joins üóùÔ∏è


| Funci√≥n          | ¬øQu√© hace?                                                    |
|------------------|---------------------------------------------------------------|
| `left_join()`    | Mantiene todas las filas de la tabla base (izquierda).        |
| `right_join()`   | Mantiene todas las filas de la tabla secundaria (derecha).    |
| `inner_join()`   | Solo mantiene coincidencias en ambas tablas.                  |
| `full_join()`    | Une todas las filas de ambas tablas, completa con `NA`.       |


Usan una **clave com√∫n** (`by = "id"`).

---
.center[![:scale 65%](input/images/joins.png)]
---

# Usando dplyr üîß

- Recordemos nuestros datos


```r
datos
```

```
##     persona edad   sexo ingresos        region
## 1      Juan   24 Hombre  1000000 Metropolitana
## 2    Matias   35 Hombre   800000 Metropolitana
## 3       Ana   45  Mujer  1300000    Valparaiso
## 4    Leonor   65  Mujer  1500000    Valparaiso
## 5 Sebastian   12 Hombre        0   Antofagasta
```

---
# Usando dplyr üîß

- Creemos una tabla con informaci√≥n a nivel de regi√≥n:


```r
regiones &lt;- data.frame(
  region = c("Arica", "Tarapaca", "Antofagasta", "Atacama", "Coquimbo", "Valparaiso", "Metropolitana", "O'Higgins", "Maule", "Nuble", "Biobio", "Araucania", "Los Rios", "Los Lagos", "Aysen", "Magallanes"),
  vict = c(31.7, 33.9, 18.7, 11.8, 17.8, 19.4, 27.7, 18.0, 14.2, 14.3, 14.3, 12.6, 22.0, 15.9, 8.7, 3.9)
)
regiones
```

```
##           region vict
## 1          Arica 31.7
## 2       Tarapaca 33.9
## 3    Antofagasta 18.7
## 4        Atacama 11.8
## 5       Coquimbo 17.8
## 6     Valparaiso 19.4
## 7  Metropolitana 27.7
## 8      O'Higgins 18.0
## 9          Maule 14.2
## 10         Nuble 14.3
## 11        Biobio 14.3
## 12     Araucania 12.6
## 13      Los Rios 22.0
## 14     Los Lagos 15.9
## 15         Aysen  8.7
## 16    Magallanes  3.9
```

---
## `left_join()` üóùÔ∏è‚¨ÖÔ∏è


```r
left_join(datos, regiones)
```

```
## Joining with `by = join_by(region)`
```

```
##     persona edad   sexo ingresos        region vict
## 1      Juan   24 Hombre  1000000 Metropolitana 27.7
## 2    Matias   35 Hombre   800000 Metropolitana 27.7
## 3       Ana   45  Mujer  1300000    Valparaiso 19.4
## 4    Leonor   65  Mujer  1500000    Valparaiso 19.4
## 5 Sebastian   12 Hombre        0   Antofagasta 18.7
```
---
## `right_join()` üóùÔ∏è‚û°Ô∏è


```r
right_join(datos, regiones)
```

```
## Joining with `by = join_by(region)`
```

```
##      persona edad   sexo ingresos        region vict
## 1       Juan   24 Hombre  1000000 Metropolitana 27.7
## 2     Matias   35 Hombre   800000 Metropolitana 27.7
## 3        Ana   45  Mujer  1300000    Valparaiso 19.4
## 4     Leonor   65  Mujer  1500000    Valparaiso 19.4
## 5  Sebastian   12 Hombre        0   Antofagasta 18.7
## 6       &lt;NA&gt;   NA   &lt;NA&gt;       NA         Arica 31.7
## 7       &lt;NA&gt;   NA   &lt;NA&gt;       NA      Tarapaca 33.9
## 8       &lt;NA&gt;   NA   &lt;NA&gt;       NA       Atacama 11.8
## 9       &lt;NA&gt;   NA   &lt;NA&gt;       NA      Coquimbo 17.8
## 10      &lt;NA&gt;   NA   &lt;NA&gt;       NA     O'Higgins 18.0
## 11      &lt;NA&gt;   NA   &lt;NA&gt;       NA         Maule 14.2
## 12      &lt;NA&gt;   NA   &lt;NA&gt;       NA         Nuble 14.3
## 13      &lt;NA&gt;   NA   &lt;NA&gt;       NA        Biobio 14.3
## 14      &lt;NA&gt;   NA   &lt;NA&gt;       NA     Araucania 12.6
## 15      &lt;NA&gt;   NA   &lt;NA&gt;       NA      Los Rios 22.0
## 16      &lt;NA&gt;   NA   &lt;NA&gt;       NA     Los Lagos 15.9
## 17      &lt;NA&gt;   NA   &lt;NA&gt;       NA         Aysen  8.7
## 18      &lt;NA&gt;   NA   &lt;NA&gt;       NA    Magallanes  3.9
```
---

## `inner_join()` üóùÔ∏èüîÄ


```r
inner_join(datos, regiones)
```

```
## Joining with `by = join_by(region)`
```

```
##     persona edad   sexo ingresos        region vict
## 1      Juan   24 Hombre  1000000 Metropolitana 27.7
## 2    Matias   35 Hombre   800000 Metropolitana 27.7
## 3       Ana   45  Mujer  1300000    Valparaiso 19.4
## 4    Leonor   65  Mujer  1500000    Valparaiso 19.4
## 5 Sebastian   12 Hombre        0   Antofagasta 18.7
```

---

## `full_join()` üóùÔ∏èüîÑÔ∏è


```r
full_join(datos, regiones)
```

```
## Joining with `by = join_by(region)`
```

```
##      persona edad   sexo ingresos        region vict
## 1       Juan   24 Hombre  1000000 Metropolitana 27.7
## 2     Matias   35 Hombre   800000 Metropolitana 27.7
## 3        Ana   45  Mujer  1300000    Valparaiso 19.4
## 4     Leonor   65  Mujer  1500000    Valparaiso 19.4
## 5  Sebastian   12 Hombre        0   Antofagasta 18.7
## 6       &lt;NA&gt;   NA   &lt;NA&gt;       NA         Arica 31.7
## 7       &lt;NA&gt;   NA   &lt;NA&gt;       NA      Tarapaca 33.9
## 8       &lt;NA&gt;   NA   &lt;NA&gt;       NA       Atacama 11.8
## 9       &lt;NA&gt;   NA   &lt;NA&gt;       NA      Coquimbo 17.8
## 10      &lt;NA&gt;   NA   &lt;NA&gt;       NA     O'Higgins 18.0
## 11      &lt;NA&gt;   NA   &lt;NA&gt;       NA         Maule 14.2
## 12      &lt;NA&gt;   NA   &lt;NA&gt;       NA         Nuble 14.3
## 13      &lt;NA&gt;   NA   &lt;NA&gt;       NA        Biobio 14.3
## 14      &lt;NA&gt;   NA   &lt;NA&gt;       NA     Araucania 12.6
## 15      &lt;NA&gt;   NA   &lt;NA&gt;       NA      Los Rios 22.0
## 16      &lt;NA&gt;   NA   &lt;NA&gt;       NA     Los Lagos 15.9
## 17      &lt;NA&gt;   NA   &lt;NA&gt;       NA         Aysen  8.7
## 18      &lt;NA&gt;   NA   &lt;NA&gt;       NA    Magallanes  3.9
```
---

class: middle, center, inverse

# _3. Manos a la obra._

---
# Ejercicio pr√°ctico

--

(1) Cargue el set de datos de la [Encuesta Nacional de Salud, Sexualidad y G√©nero 2023](https://datos.gob.cl/dataset/encuesta-nacional-de-salud-sexualidad-y-genero-enssex-2022-2023/resource/ed81f50c-1c7d-43d9-9083-dfc161e0cd66)

--

(2) Seleccione las variables de edad (`p4`), sexo (`p1`), regi√≥n (`region`), calidad de vida (`p8`), percepci√≥n de salud (`p10`). Use `select()`.

--

(3) Renombre las variables escogidas por nombres m√°s sustantivos. Use `rename()`.

--

(4) Cree una nueva variable llamada `edad_tramos`, siguiendo los tramos de 18-24, 25-34, 35-44, 45-54, 55-54, +64 a√±os. Use `mutate()` y `case_when()`.

---
# Ejercicio pr√°ctico

(5) Filtre el dataset por los individuos que no se encuentren en el tramo de 18-24 a√±os. Use `filter()`.

--

(6) Genere una tabla con la media de las percepciones de salud a nivel regi√≥n y gu√°rdela en un nuevo objeto. Use `group_by()`, `summarise()` y `ungroup()`.

--

(7) Haga un join entre el dataset a nivel de personas y la tabla de la media de percepci√≥n de salud por regi√≥n. Utilice `left_join`

--

(8) Ordene las filas del dataset por edad ascendente. Utilice `arrange()`

---
# Algunos recursos...ü§ì

### (1) [P√°gina de dplyr](https://dplyr.tidyverse.org/)

### (2) [Cheeatsheet dplyr](https://nyu-cdsc.github.io/learningr/assets/data-transformation.pdf)

### (3) [Tutoriales R coder](https://r-coder.com/select-dplyr-en-r/)


---

class: middle, center, inverse

# _¬°Muchas gracias!_
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://jciturras.github.io/ayudantia-sol3051/slides/00-intro-r/macros.js"></script>
<script>var slideshow = remark.create({
  "ratio": "16:9",
  "countIncrementalSlides": false,
  "slideNumberFormat": "<div class=\"progress-bar-container\">\n  <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">\n  </div>\n</div>\n"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
